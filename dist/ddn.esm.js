/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Document Normalizer JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2022, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 1.0.10 (js 20221103)
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on ddn JS: https://www.dynamsoft.com/document-normalizer/sdk-javascript/
 */
import{Howl as e}from"dm-howler";const t="undefined"==typeof self,s=" is not allowed to change after `createInstance` or `loadWasm` is called.",i=!t&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",r=!t&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",a=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let s=0;s<e.length;++s){if(!t){let t=document.createElement("a");t.href=e[s],e[s]=t.href}e[s].endsWith("/")||(e[s]+="/")}}return e},n=(()=>{if(!t&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})();let o,l,d,c,h;if("undefined"!=typeof navigator&&(o=navigator,l=o.userAgent,d=o.platform,c=o.mediaDevices),!t){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:o.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:d,search:"Win"},Mac:{str:d},Linux:{str:d}};let s="unknownBrowser",i=0,r="unknownOS";for(let t in e){const r=e[t]||{};let a=r.str||l,n=r.search||t,o=r.verStr||l,d=r.verSearch||t;if(d instanceof Array||(d=[d]),-1!=a.indexOf(n)){s=t;for(let e of d){let t=o.indexOf(e);if(-1!=t){i=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const s=t[e]||{};let i=s.str||l,a=s.search||e;if(-1!=i.indexOf(a)){r=e;break}}"Linux"==r&&-1!=l.indexOf("Windows NT")&&(r="HarmonyOS"),h={browser:s,version:i,OS:r}}t&&(h={browser:"ssr",version:0,OS:"ssr"});const u="undefined"!=typeof WebAssembly&&l&&!(/Safari/.test(l)&&!/Chrome/.test(l)&&/\(.+\s11_2_([2-6]).*\)/.test(l)),g=!("undefined"==typeof Worker),m=!(!c||!c.getUserMedia),_=async()=>{let e=!1;if(m)try{(await c.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};"Chrome"===h.browser&&h.version>66||"Safari"===h.browser&&h.version>13||"OPR"===h.browser&&h.version>43||"Edge"===h.browser&&h.version;const w=e=>e&&"object"==typeof e&&"function"==typeof e.then;class f{constructor(){this._instanceID=void 0,this._lastInnerParseDuration=0,this.bDestroyed=!1,this._dce=null,this._imgSource=null,this._intervalGetVideoFrame=0,this._arrPolygons=[],this.dceFrame=null,this.dsImage=null,this._maxCvsSideLength="iPhone"==h.OS||"Android"==h.OS||"HarmonyOS"==h.OS?2048:4096,this.canvas=null,this._intervalDetectVideoPause=1e3,this._bPauseScan=!1,this._bOnlyDrawOneQuad=!1,this.intervalTime=0,this._tempSolutionStatus="closed",this.bPlaySoundOnSuccessfulRead=!1,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.beepSound=new e({src:[this._soundSource],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}}),this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300}static getVersion(){return this._version}static get license(){return this._license}static set license(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`license`"+s);i._license=t})(f,e)}static set sessionPassword(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`sessionPassword`"+s);i._sessionPassword=t})(f,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:u,worker:g,getUserMedia:m,camera:await _(),browser:h.browser,version:h.version,OS:h.OS}))()}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+s);i._deviceFriendlyName=t||""})(f,e)}get disposed(){return this.bDestroyed}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");f._engineResourcePath=(e=>{if(null==e&&(e="./"),!t){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+s);i._licenseServer=a(t)})(f,e)}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed?null:this._dce}static isWasmLoaded(){return this._pLoad.isFulfilled}static isDSImage(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&("data"in e&&("width"in e&&("height"in e&&"pixelFormat"in e)))}static isImageSource(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"getImage"in e}static isDCEFrame(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&("data"in e&&("region"in e&&("sx"in e&&("sy"in e&&("width"in e&&("height"in e&&("colorMode"in e&&("timeSpent"in e&&("timeStamp"in e&&("isCropped"in e&&("toCanvas"in e&&("_sWidth"in e&&("_sHeight"in e&&"_bUseWebGL"in e)))))))))))))}async _registerDCEControler(){if(!this.dce)return;f._onLog&&f._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const t=this._dceControler;t.register(this),t.setDisiredValue(this,"refreshInterval",200),t.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength);const s=e.getUIElement(),i=this.dce.constructor;if("@engineResourcePath/dce.ui.html"===i._defaultUIElementURL)try{s?s===t._innerSetUI&&(await e.setUIElement(`${i.engineResourcePath}dce.ui.html`),t._innerSetUI=e.getUIElement()):(await e.setUIElement(`${i.engineResourcePath}dce.ui.html`),t._innerSetUI=e.getUIElement())}catch(t){await e.setUIElement(i.defaultUIElementURL)}else s||await e.setUIElement(i.defaultUIElementURL);this.callbackCameraChange=()=>{this._drawResults(null),this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._drawResults(null),this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async e=>{if(this.dceFrame=e,this.quadResults=await this._detectQuad_DCEFrame(e),this._bOnlyDrawOneQuad&&this.quadResults.length>1){let e=[];for(let t=0;t<this.quadResults.length;t++){let s=Math.sqrt(Math.pow(this.quadResults[t].location.points[1].x-this.quadResults[t].location.points[0].x,2)+Math.pow(this.quadResults[t].location.points[1].y-this.quadResults[t].location.points[0].y,2)),i=Math.sqrt(Math.pow(this.quadResults[t].location.points[2].x-this.quadResults[t].location.points[1].x,2)+Math.pow(this.quadResults[t].location.points[2].y-this.quadResults[t].location.points[1].y,2));e.push(s*i)}let t=Math.max(...e),s=e.indexOf(t);this.quadResults=[this.quadResults[s]]}if(this._quadFilterFun&&this.quadResults.length>=1){for(let e=0;e<this.quadResults.length;e++)this._quadFilterFun(this.quadResults[e])||delete this.quadResults[e];this.quadResults=this.quadResults.filter(Boolean)}let t=null;if(this.quadResults&&this.quadResults.length){const{sx:e,sy:s,width:i,height:r,_sWidth:a,_sHeight:n}=this.dceFrame;t=this.quadResults.map((e=>({location:JSON.parse(JSON.stringify(e.location))}))),f.recalculateResultLocation(t,e,s,a,n,i,r)}if(this._drawResults(t),this.onQuadDetected&&this.dce.isOpen()&&!this._bPauseScan){let t=this._cloneDecodeResults(this.quadResults);this.onQuadDetected(t||[],e)}},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(f._onLog&&f._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this.dce=null)}async setImageSource(e,t){if(null==e)return this._imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this._imgSource=null;else{if(!f.isImageSource(e))throw new Error("Invalid value.");this._logoutDCEControler(),this._imgSource=e}t&&t.resultsHighlightBaseShapes&&(this._drawingItemNamespace=t.resultsHighlightBaseShapes)}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:t,ls:i,sp:r,rmk:n}=(e=>{const t=e;if(t._pLoad.isEmpty){let e,s,i=t._license||"",r=JSON.parse(JSON.stringify(t._licenseServer)),n=t._sessionPassword,o=0;if(i.startsWith("t")||i.startsWith("f"))o=0;else if(0===i.length||i.startsWith("P")||i.startsWith("L")||i.startsWith("Y")||i.startsWith("A"))o=1;else{o=2;const t=i.indexOf(":");if(-1!=t&&(i=i.substring(t+1)),i.startsWith("DLS2")){let t;try{let e=i.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(i=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof i&&(i=JSON.stringify(i)),0===r.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),r=a(e)}!n&&t.sessionPassword&&(n=t.sessionPassword),e=t.remark}("200001"===i||i.startsWith("200001-"))&&(r&&r.length||(i="")),i||(o=1)}if(o&&(globalThis.crypto||(s="Please upgrade your browser to support online key."),globalThis.crypto.subtle||(s="Require https to use online key in this browser.")),s){if(1!==o)throw new Error(s);o=0,console.warn(s),t._lastErrorCode=-1,t._lastErrorString=s}return 1===o&&(i="",console.warn("Applying for a public trial license ...")),{lt:o,l:i,ls:r,sp:n,rmk:e}}throw new Error("Can't preprocess license again"+s)})(f);this._pLoad.task=async(s,a)=>{let o=f.engineResourcePath+f._workerName;f.engineResourcePath.startsWith(location.origin)||(o=await fetch(o).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),f._ddnWorker=new Worker(o),f._ddnWorker.onerror=e=>{let t=new Error(e.message);a(t)},f._ddnWorker.onmessage=async t=>{let i=t.data?t.data:t;switch(i.type){case"log":f._onLog&&f._onLog(i.message);break;case"load":{i.message&&(i.message=i.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-document-normalizer/#javascript)"));let t,r=!1;1===e&&(r=!0),i.success?(f._ddnWorker.onerror=null,f._version=i.version+"(JS "+f._jsVersion+"."+f._jsEditVersion+")",f._onLog&&f._onLog("load ddn worker success"),i.message&&console.warn(i.message)):(t=new Error(i.message),t.stack=i.stack+"\n"+t.stack,r||111==i.ltsErrorCode&&-1!=i.message.toLowerCase().indexOf("trial license")&&(r=!0)),r&&f.showDialog(i.success?"warn":"error",i.message),i.success?s():a(t);break}case"task":{let e=i.id,t=i.body;try{f._taskCallbackMap.get(e)(t),f._taskCallbackMap.delete(e)}catch(t){throw f._taskCallbackMap.delete(e),t}break}default:f._onLog&&f._onLog(t)}},f._ddnWorker.postMessage({type:"loadWasm",bd:f._bWasmDebug,mapProductInfo:{ddn:{version:f._jsVersion,engineResourcePath:f.engineResourcePath}},brtk:!!e,bptk:1===e,l:t,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:h,fn:f.deviceFriendlyName,ls:i,sp:r,rmk:n})}}await this._pLoad}static async showDialog(e,t){await(async(e,t,s)=>{if(!e._bNeverShowDialog)try{let i=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!i.ok)throw Error("Get license dialog fail. Network Error: "+i.statusText);let r=await i.text();if(!r.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let a=document.createElement("div");a.innerHTML=r;let n=[];for(let e=0;e<a.childElementCount;++e){let t=a.children[e];t instanceof HTMLStyleElement&&(n.push(t),document.head.append(t))}let o=1==a.childElementCount?a.children[0]:a;o.remove();let l,d,c,h,u,g=[o],m=o.children;for(let e of m)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let e of g)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",(t=>{if(e==t.target){o.remove();for(let e of n)e.remove()}}));else if(!d&&e.classList.contains("dls-license-icon-close"))d=e,e.addEventListener("click",(()=>{o.remove();for(let e of n)e.remove()}));else if(!c&&e.classList.contains("dls-license-icon-error"))c=e,"error"!=t&&e.remove();else if(!h&&e.classList.contains("dls-license-icon-warn"))h=e,"warn"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-msg-content")){u=e;let t=s;for(;t;){let s=t.indexOf("["),i=t.indexOf("]",s),r=t.indexOf("(",i),a=t.indexOf(")",r);if(-1==s||-1==i||-1==r||-1==a){e.appendChild(new Text(t));break}s>0&&e.appendChild(new Text(t.substring(0,s)));let n=document.createElement("a"),o=t.substring(s+1,i);n.innerText=o;let l=t.substring(r+1,a);n.setAttribute("href",l),n.setAttribute("target","_blank"),e.appendChild(n),t=t.substring(a+1)}}document.body.appendChild(o)}catch(t){e._onLog&&e._onLog(t.message||t)}})(this,e,t)}static async createInstanceInWorker(){return await f.loadWasm(),await new Promise(((e,t)=>{let s=f._nextTaskID++;f._taskCallbackMap.set(s,(async s=>{if(s.success)return f.defaultTemplate=s.defaultSettings,e(s.instanceID);{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),f._ddnWorker.postMessage({type:"createInstance",id:s})}))}static async createInstance(){const e=await f.detectEnvironment();if("Windows"===e.OS&&"Chrome"===e.browser&&e.version<85||"Android"===e.OS&&"Chrome"===e.browser&&e.version<94||"Firefox"===e.browser&&e.version<99||"Safari"===e.browser&&e.version<15)throw new Error("Current browser versions do not support DDNJS.");let t=new f;return t._instanceID=await f.createInstanceInWorker(),t}async getRuntimeSettings(){return await new Promise(((e,t)=>{let s=f._nextTaskID++;f._taskCallbackMap.set(s,(s=>{if(s.success)return e(JSON.parse(s.results));{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}})),f._ddnWorker.postMessage({type:"outputRuntimeSettingsToString",id:s,instanceID:this._instanceID})}))}async setRuntimeSettings(e){if(e){if("string"==typeof e)"lowcontrast"===e&&(e='{ "ImageParameterArray" : [{"NormalizerParameterName":"NormalizerParameter","GrayscaleEnhancementModes":[{"Mode" : "GEM_GENERAL"},{"Mode" : "GEM_SHARPEN_SMOOTH","SharpenBlockSizeX":3,"SharpenBlockSizeY":3,"SmoothBlockSizeX":3,"SmoothBlockSizeY":3}],"BinarizationModes" : [{"Mode" : "BM_LOCAL_BLOCK","BlockSizeX" : 31,"BlockSizeY" : 31, "MorphOperation" : "Close","MorphOperationKernelSizeX" : 11,"MorphOperationKernelSizeY" : 11, "ThresholdCompensation" : 3}],"Name" : "DM_Defaut_ImageParameter"}], "NormalizerParameterArray" : [{\n "ColourMode" : "ICM_COLOUR", "ContentType" : "CT_DOCUMENT","Name" : "NormalizerParameter"}]}');else{if("object"!=typeof e)throw TypeError("'setRuntimeSettings(settings)': Type of 'runtimeSettings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return await new Promise(((t,s)=>{let i=f._nextTaskID++;f._taskCallbackMap.set(i,(e=>{if(!e.success){let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}try{const s=JSON.parse(e.returnResult);if(0!==s.exception)throw new Error(s.description);return t(s)}catch(e){return s(e)}})),f._ddnWorker.postMessage({type:"initRuntimeSettingsFromString",id:i,instanceID:this._instanceID,settings:e})}))}}async resetRuntimeSettings(){return await new Promise(((e,t)=>{let s=f._nextTaskID++;f._taskCallbackMap.set(s,(s=>{if(!s.success){let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}try{return e()}catch(e){return t(e)}})),f._ddnWorker.postMessage({type:"initRuntimeSettingsFromString",id:s,instanceID:this._instanceID,settings:f.defaultTemplate})}))}async setUIElement(e){await this.dce.setUIElement(e)}setQuadResultFilter(e){this._quadFilterFun=e}async detectQuad(e){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');return e instanceof Blob?await this._detectQuad_Blob(e):f.isDSImage(e)?await this._detectQuad_DSImage(e,!0):f.isDCEFrame(e)?await this._detectQuad_DCEFrame(e,!0):e instanceof HTMLImageElement?await this._detectQuad_Image(e):e instanceof HTMLCanvasElement?await this._detectQuad_Canvas(e):"string"==typeof e?await this._detectQuad_Url(e):await Promise.reject(TypeError("'detectQuad(source, templateName)': Type of 'source' should be 'Blob', 'DSImage', 'HTMLImageElement', 'HTMLCanvasElement', 'Url'."))}async _detectQuad_Blob(e){let t=null,s=null;if("undefined"!=typeof createImageBitmap)try{t=await createImageBitmap(e)}catch(e){}t||(s=await function(e){return new Promise(((t,s)=>{let i=URL.createObjectURL(e),r=new Image;r.ddnObjUrl=i,r.src=i,r.onload=()=>{t(r)},r.onerror=e=>{s(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let i=await this._detectQuad_Image(t||s);return t&&t.close(),i}async _detectQuad_DSImage(e,t){if(f._onLog&&f._onLog("_detectQuad_DSImage(dsImage)"),!f.isDSImage(e))return null;const{width:s,height:i}=e;let r={colorMode:e.pixelFormat,imgData:t?new Uint8Array(e.data):e.data,width:s,height:i,stride:4*s,format:10};return await this._detectQuad_Worker(r)}async _detectQuad_Image(e){let t,s,i=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(i,r);if(a>this._maxCvsSideLength){let e=this._maxCvsSideLength/a;t=Math.round(i*e),s=Math.round(r*e)}else t=i,s=r;this.canvas||(this.canvas=document.createElement("canvas"));const n=this.canvas;n.width===t&&n.height===s||(n.width=t,n.height=s),n.ctx2d||(n.ctx2d=n.getContext("2d",{willReadFrequently:!0}));return n.ctx2d.drawImage(e,0,0,i,r,0,0,t,s),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._detectQuad_Canvas(n)}async _detectQuad_Canvas(e){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if(0===e.width||0===e.height)throw Error("The width or height of the 'canvas' is 0.");let t={colorMode:"rgba",imgData:(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data,width:e.width,height:e.height,stride:4*e.width,format:10};return await this._detectQuad_Worker(t)}async _detectQuad_DCEFrame(e,t){if(!f.isDCEFrame(e))return null;let s={colorMode:e.colorMode,imgData:t?new Uint8Array(e.data):e.data,width:e.width,height:e.height,stride:4*e.width,format:10};return await this._detectQuad_Worker(s)}async _detectQuad_Url(e){{let t=await new Promise(((t,s)=>{let i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.send(),i.onloadend=async()=>{t(i.response)},i.onerror=()=>{s(new Error("Network Error: "+i.statusText))}}));return await this._detectQuad_Blob(t)}}async _detectQuad_Worker(e){return await new Promise(((t,s)=>{const{colorMode:i,imgData:r,width:a,height:n}=e;let o=f._nextTaskID++;f._taskCallbackMap.set(o,(e=>{if(!e.success){let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}try{if([0,-50001].includes(e.decodeReturn.exception)){this.dce&&this.dceFrame?this.dceFrame.data=e.buffer:this._imgSource&&this.dsImage&&(this.dsImage.data=e.buffer);let s=e.decodeReturn.results;if(this._quadFilterFun&&s.length>=1){for(let e=0;e<s.length;e++)this._quadFilterFun(s[e])||delete s[e];s=s.filter(Boolean)}return t(s)}throw new Error(e.decodeReturn.description)}catch(e){return s(e)}})),f._ddnWorker.postMessage({type:"detectQuad",id:o,instanceID:this._instanceID,body:{colorMode:i,imgData:r,width:a,height:n}},[r.buffer])}))}async normalize(e,t){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');let s;return s=t&&t.quad?t.quad:"",e instanceof Blob?await this._normalize_Blob(e,s):f.isDSImage(e)?await this._normalize_DSImage(e,s):f.isDCEFrame(e)?await this._normalize_DCEFrame(e,s):e instanceof HTMLImageElement?await this._normalize_Image(e,s):e instanceof HTMLCanvasElement?await this._normalize_Canvas(e,s):"string"==typeof e?await this._normalize_Url(e,s):await Promise.reject(TypeError("'normalize(source, quad)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}async _normalize_Blob(e,t){let s=null,i=null;if("undefined"!=typeof createImageBitmap)try{s=await createImageBitmap(e)}catch(e){}s||(i=await function(e){return new Promise(((t,s)=>{let i=URL.createObjectURL(e),r=new Image;r.ddnObjUrl=i,r.src=i,r.onload=()=>{t(r)},r.onerror=e=>{s(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let r=await this._normalize_Image(s||i,t);return s&&s.close(),r}async _normalize_DSImage(e,t){if(f._onLog&&f._onLog("_normalize_DSImage(dsImage, quad)"),!f.isDSImage(e))return null;const{data:s,width:i,height:r}=e;let a=s,n={colorMode:e.pixelFormat,imgData:a,width:i,height:r,stride:4*i,format:10};return await this._normalize_Worker(n,t)}async _normalize_DCEFrame(e,t){if(!f.isDCEFrame(e))return null;const{data:s,width:i,height:r}=e;let a=s,n={colorMode:e.colorMode,imgData:a,width:i,height:r,stride:4*i,format:10};return await this._normalize_Worker(n,t)}async _normalize_Image(e,t){let s,i,r=e instanceof HTMLImageElement?e.naturalWidth:e.width,a=e instanceof HTMLImageElement?e.naturalHeight:e.height,n=Math.max(r,a);if(n>this._maxCvsSideLength){let e=this._maxCvsSideLength/n;s=Math.round(r*e),i=Math.round(a*e)}else s=r,i=a;this.canvas||(this.canvas=document.createElement("canvas"));const o=this.canvas;o.width===s&&o.height===i||(o.width=s,o.height=i),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0}));return o.ctx2d.drawImage(e,0,0,r,a,0,0,s,i),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._normalize_Canvas(o,t)}async _normalize_Canvas(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if(0===e.width||0===e.height)throw Error("The width or height of the 'canvas' is 0.");let s={colorMode:"rgba",imgData:(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data,width:e.width,height:e.height,stride:4*e.width,format:10};return await this._normalize_Worker(s,t)}async _normalize_Url(e,t){{let s=await new Promise(((t,s)=>{let i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.send(),i.onloadend=async()=>{t(i.response)},i.onerror=()=>{s(new Error("Network Error: "+i.statusText))}}));return await this._normalize_Blob(s,t)}}async _normalize_Worker(e,t){const{colorMode:s,imgData:i,width:r,height:a}=e;return await new Promise(((e,n)=>{let o=f._nextTaskID++;f._taskCallbackMap.set(o,(async t=>{if(!t.success){let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}try{let s=t.resultNormalize,i=s.result.image.bytes,r=this._getNorImgeData(i,s.result.image),a=this._handleImageData(r,s.result.image.format);return e(a)}catch(e){return n(e)}})),f._ddnWorker.postMessage({type:"normalize",id:o,instanceID:this._instanceID,body:{colorMode:s,imgData:i,width:r,height:a},quad:t})}))}_handleImageData(e,t){let s;6===t?s="rgba":2===t&&(s="grey");return{image:{data:new Uint8Array(e.image.data),width:e.image.width,height:e.image.height,pixelFormat:s,toBlob:t=>this._toBlob(e,t),toImage:t=>this._toImage(e,t),toCanvas:()=>this._toCanvas(e)},saveToFile:(t,s)=>{if(!t)return null;if("string"!=typeof t)throw new TypeError("Filename must be of type String.");const i=t.split(".");if(!["png","jpeg"].includes(i[i.length-1]))throw new Error("The filename suffix must be PNG or JPEG.");return this._saveToFile(t,e,s)}}}async _toBlob(e,t){const s=this._toCanvas(e);return new Promise(((e,i)=>{s.toBlob((t=>e(t)),t)}))}_toImage(e,t){const s=this._toCanvas(e);let i=new Image,r=s.toDataURL(t);return i.src=r,i}_toCanvas(e){const t=document.createElement("canvas");t.width=e.image.width,t.height=e.image.height;return t.getContext("2d",{willReadFrequently:!0}).putImageData(e.image,0,0),t}async _saveToFile(e,t,s){return await new Promise((async(i,r)=>{try{const r=await this._toBlob(t),a=e.split("."),n=new File([r],e,{type:`image/${a[a.length-1]}`});if(s){const t=URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=e,s.click()}return i(n)}catch(e){return r()}}))}_getNorImgeData(e,t){if(!(e&&e instanceof Uint8Array))throw Error("Parameter type error");let s;if(6===t.format){const t=e.length/3;s=new Uint8ClampedArray(4*t);for(let i=0;i<t;++i)s[4*i]=e[3*i+2],s[4*i+1]=e[3*i+1],s[4*i+2]=e[3*i],s[4*i+3]=255}else if(2===t.format){const t=e.length;s=new Uint8ClampedArray(4*t);for(let i=0;i<t;i++)s[4*i]=s[4*i+1]=s[4*i+2]=e[i],s[4*i+3]=255}else if(0===t.format){t.width=8*t.stride,t.height=e.length/t.stride;const i=e.length;s=new Uint8ClampedArray(8*i*4);for(let t=0;t<i;t++){let i=e[t];for(let e=0;e<8;++e)s[4*(8*t+e)]=s[4*(8*t+e)+1]=s[4*(8*t+e)+2]=(128&i)/128*255,s[4*(8*t+e)+3]=255,i<<=1}}return{image:new ImageData(s,t.width,t.height)}}getUIElement(){return this.dce.getUIElement()}async startScanning(e){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');if(!this.dce&&!this._imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");"closed"==this._tempSolutionStatus&&(this._tempSolutionStatus="opening","opening"==this._tempSolutionStatus&&(this.dce&&(this._bindUI(),this.dce.isOpen()?(e&&this.dce.appendAndShowUI(),JSON.parse(JSON.stringify(this.dce.playCallbackInfo))):await this.dce.open(e),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())),"opening"==this._tempSolutionStatus&&(this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()}),0)),this._tempSolutionStatus="opened")))}stopScanning(e){this.dce&&(this._drawResults(null),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._intervalGetVideoFrame=0,this._tempSolutionStatus="closed"}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}pauseScanning(e){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');if(e&&e.keepResultsHighlighted||this._drawResults(null),this.dce&&!this.dce.video.paused){if(this._bPauseScan=!0,this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');if(this.dce&&!this.dce.video.paused){if(this._bPauseScan=!1,this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}set whenToPlaySound(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&("quadDetected"===e&&e)}get whenToPlaySound(){return!1===this.bPlaySoundOnSuccessfulRead?"never":this.bPlaySoundOnSuccessfulRead}get soundSource(){return this._soundSource}set soundSource(t){this._soundSource=t,this.beepSound=new e({src:[this._soundSource],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}})}set whenToVibrate(e){this.bVibrateOnSuccessfulRead="never"!==e&&("quadDetected"===e&&e)}get whenToVibrate(){return!1===this.bVibrateOnSuccessfulRead?"never":this.bVibrateOnSuccessfulRead}async getScanSettings(){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');return await new Promise(((e,t)=>{try{let t={};return t.whenToPlaySound=this.whenToPlaySound,t.soundOnSuccessfulDetection=this.soundSource,t.whenToVibrate=this.whenToVibrate,t.intervalTime=this.intervalTime,t.vibrateDuration=this.vibrateDuration,e(t)}catch(e){return t(e)}}))}async updateScanSettings(e){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');return await new Promise(((t,s)=>{try{if(!e)return;const s=JSON.parse(JSON.stringify(e));return s.hasOwnProperty("intervalTime")&&(s.intervalTime<0&&(s.intervalTime=0),this.intervalTime=s.intervalTime,delete s.intervalTime),s.hasOwnProperty("whenToPlaySound")&&(["never","quadDetected"].includes(s.whenToPlaySound)?this.whenToPlaySound=s.whenToPlaySound:this.whenToPlaySound="never",delete s.whenToPlaySound),s.hasOwnProperty("soundOnSuccessfulDetection")&&(this.soundSource=s.soundOnSuccessfulDetection,delete s.soundOnSuccessfulDetection),s.hasOwnProperty("whenToVibrate")&&(["never","quadDetected"].includes(s.whenToVibrate)?this.whenToVibrate=s.whenToVibrate:this.whenToVibrate="never",delete s.whenToVibrate),s.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=s.vibrateDuration,delete s.vibrateDuration),t()}catch(e){return s()}}))}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._drawResults(null);if((!this.dce||!this.dce.video||this.dce.video.paused)&&!this._imgSource||this._bPauseScan)return f._onLog&&f._onLog("Video or scan is paused, or imageSource is not set. Ask in 1s."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));if(f._onLog&&f._onLog("======= once read ======="),this.dce)this.dceFrame=this._getVideoFrame(),this.dceFrame||this._drawResults(null);else if(this._imgSource){if(this.dsImage=await this._imgSource.getImage(),!f.isDSImage(this.dsImage))throw new Error("Invalid DSImage.");this.dsImage||this._drawResults(null)}if(!this.dceFrame&&!this.dsImage)return this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(async()=>{if(this.dceFrame?this.quadResults=await this._detectQuad_DCEFrame(this.dceFrame):this.dsImage&&(this.quadResults=await this._detectQuad_DSImage(this.dsImage)),this._bOnlyDrawOneQuad&&this.quadResults.length>1){let e=[];for(let t=0;t<this.quadResults.length;t++){let s=Math.sqrt(Math.pow(this.quadResults[t].location.points[1].x-this.quadResults[t].location.points[0].x,2)+Math.pow(this.quadResults[t].location.points[1].y-this.quadResults[t].location.points[0].y,2)),i=Math.sqrt(Math.pow(this.quadResults[t].location.points[2].x-this.quadResults[t].location.points[1].x,2)+Math.pow(this.quadResults[t].location.points[2].y-this.quadResults[t].location.points[1].y,2));e.push(s*i)}let t=Math.max(...e),s=e.indexOf(t);this.quadResults=[this.quadResults[s]]}let e=null;if(this.quadResults&&this.quadResults.length){const{sx:t,sy:s,width:i,height:r,_sWidth:a,_sHeight:n}=this.dceFrame;e=this.quadResults.map((e=>({location:JSON.parse(JSON.stringify(e.location))}))),f.recalculateResultLocation(e,t,s,a,n,i,r)}return this._drawResults(e),this.quadResults})().then((e=>{if(f._onLog&&f._onLog(e),(this.dce&&this.dce.isOpen()&&this.dce.video&&!this.dce.video.paused||this._imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let e=!1;!0!==this.bPlaySoundOnSuccessfulRead&&"quadDetected"!==this.bPlaySoundOnSuccessfulRead||(e=!0),e&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let e=!1;if(!0!==this.bVibrateOnSuccessfulRead&&"quadDetected"!==this.bVibrateOnSuccessfulRead||(e=!0),e)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onQuadDetected){let t=this._cloneDecodeResults(e);this.onQuadDetected(t||[],this.dce?this.dceFrame:this.dsImage)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this._drawResults(null),this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),f._onLog&&f._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}static recalculateResultLocation(e,t,s,i,r,a,n){if(e.length>0)for(let o of e){let e=o.location.points,l=a/i,d=n/r;e[0].x=e[0].x/l+t,e[1].x=e[1].x/l+t,e[2].x=e[2].x/l+t,e[3].x=e[3].x/l+t,e[0].y=e[0].y/d+s,e[1].y=e[1].y/d+s,e[2].y=e[2].y/d+s,e[3].y=e[3].y/d+s}}static reverseRecalculateResultLocation(e,t,s,i,r,a,n){if(e.length>0)for(let o of e){let e=o.location.points,l=a/i,d=n/r;e[0].x=e[0].x*l-t,e[1].x=e[1].x*l-t,e[2].x=e[2].x*l-t,e[3].x=e[3].x*l-t,e[0].y=e[0].y*d-s,e[1].y=e[1].y*d-s,e[2].y=e[2].y*d-s,e[3].y=e[3].y*d-s}}_drawResults(e){if(this.dce&&!this._bPauseScan&&this._drawingItemNamespace&&this._drawingItemNamespace.DT_Polygon){if(!this._ddnDrawingLayer){if(!this.dce.isOpen())return;this._ddnDrawingLayer=this.dce.getDrawingLayer(1),this.dce.updateDrawingStyle(1,{lineWidth:3})}e||(e=[]);for(let t=0;t<e.length;t++){let s,i=e[t].location.points;this._arrPolygons[t]?(s=this._arrPolygons[t],this._ddnDrawingLayer.hasDrawingItem(s)||this._ddnDrawingLayer.addDrawingItem(s),s.set("vertices",[{x:i[0].x,y:i[0].y},{x:i[1].x,y:i[1].y},{x:i[2].x,y:i[2].y},{x:i[3].x,y:i[3].y}])):(s=new this._drawingItemNamespace.DT_Polygon([{x:i[0].x,y:i[0].y},{x:i[1].x,y:i[1].y},{x:i[2].x,y:i[2].y},{x:i[3].x,y:i[3].y}]),this._ddnDrawingLayer.addDrawingItem(s),this._arrPolygons[t]=s)}for(let t=e.length;t<this._arrPolygons.length;t++)this._ddnDrawingLayer.removeDrawingItem(this._arrPolygons[t]);this._ddnDrawingLayer.renderAll()}}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let s of e)t.push(this._cloneDecodeResults(s));return t}{let t=e;return JSON.parse(JSON.stringify(t,((e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t)))}}_getVideoFrame(){if(!this.dce)return null;if(this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;return this.dce.getFrameFromBuffer()}confirmQuadForNormalization(){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');if(!this.dce)return console.warn("This feature is only supported by Dynamsoft Camera Enhancer.");this.dce&&this.dce.isOpen()&&!this._bPauseScan&&this._ddnDrawingLayer&&"viewer"===this._ddnDrawingLayer.getMode()&&this.quadResults.length&&(this._ddnDrawingLayer.setMode("editor"),this._bPauseScan=!0,this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"pause")))}async normalizeWithConfirmedQuad(){if(this.bDestroyed)throw new Error('"DocumentNormalizer" instance has been disposed');if("editor"!==this._ddnDrawingLayer.getMode())return null;const e=this.dce.getSelectedDrawingItems();if(e.length>1)throw new Error("Only one quadrilateral can be selected.");let t=null;if(this.dce&&this.dce.isOpen()&&this._ddnDrawingLayer&&(1===e.length||1===this._ddnDrawingLayer.getDrawingItems().length)){let s=this._arrPolygons.indexOf(e[0]);s=-1===s?0:s;const{sx:i,sy:r,_sWidth:a,_sHeight:n,width:o,height:l}=this.dceFrame,d=this.quadResults[s].location,c=[{location:{points:this._arrPolygons[s].get("vertices")}}];f.reverseRecalculateResultLocation(c,i,r,a,n,o,l);for(let e=0;e<this.quadResults[s].location.points.length;e++)d.points[e].coordinate[0]=c[0].location.points[e].x,d.points[e].coordinate[1]=c[0].location.points[e].y;const h={colorMode:this.dceFrame.colorMode,imgData:this.dceFrame.data,width:this.dceFrame.width,height:this.dceFrame.height,stride:4*this.dceFrame.width,format:10};try{t=await this._normalize_Worker(h,d)}catch(e){throw new Error("Please confirm whether the license supports normalize or whether the edited quad is out of bounds.")}}return this._ddnDrawingLayer.setMode("viewer"),this._bPauseScan=!1,this._dceControler&&(this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser(),this._dceControler.setDisiredAction(this,"resume")),this.dce.singleFrameMode||(this._ddnDrawingLayer.clearDrawingItems(),this.quadResults=[]),t}dispose(){if(f._onLog&&f._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,(this.dce||"opening"===this._tempSolutionStatus||"opened"===this._tempSolutionStatus)&&this.stopScanning(!0),this.setImageSource(null),this._arrPolygons=[],this.quadResults=[];let e=f._nextTaskID++;f._taskCallbackMap.set(e,(e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}})),f._ddnWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}var p,y,S,A;f._jsVersion="1.0.10",f._jsEditVersion="20221103",f._version=`loading...(JS ${f._jsVersion}.${f._jsEditVersion})`,f._license=i,f._workerName=`ddn-${f._jsVersion}.browser.worker.js`,f._bWasmDebug=!1,f._pLoad=new class extends Promise{constructor(e){let t,s;super(((e,i)=>{t=e,s=i})),this._s="pending",this.resolve=e=>{this.isPending&&(w(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",s(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,w(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const s=await t;e===this._task&&this.resolve(s)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}},f._bNeverShowDialog=!1,f._sessionPassword=r,f.browserInfo=h,f._deviceFriendlyName="",f._taskCallbackMap=new Map,f._nextTaskID=0,f._engineResourcePath=n,f._licenseServer=[],function(e){e[e.CT_UNKNOWN=0]="CT_UNKNOWN",e[e.CT_DOCUMENT=1]="CT_DOCUMENT",e[e.CT_TABLE=2]="CT_TABLE"}(p||(p={})),function(e){e[e.DM_PERSPECTIVE_CORRECTION=1]="DM_PERSPECTIVE_CORRECTION"}(y||(y={})),function(e){e[e.ICM_BINARY=1]="ICM_BINARY",e[e.ICM_GRAYSCALE=2]="ICM_GRAYSCALE",e[e.ICM_COLOUR=4]="ICM_COLOUR"}(S||(S={})),function(e){e[e.QDM_GENERAL=1]="QDM_GENERAL",e[e.QDM_SKIP=0]="QDM_SKIP"}(A||(A={}));export{f as DocumentNormalizer,p as EnumContentType,y as EnumDeskewMode,S as EnumImageColourMode,A as EnumQuadrilateralDetectionMode};
